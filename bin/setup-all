#! /usr/bin/env bash
#
# Runs all of the `certbot` setup commands
#
# Usage:
#   {{go}} {{cmd}} [<site_name> <key_file> <email_address>]
#
# Where:
#   site_name      Canonical host name for the web site
#   key_file       Name of the private key used to generate the CSR
#   email_address  Email address to include in the certificate
#
# This will run all of the following:
#
#   {{go}} certbot-setup
#   {{go}} site-setup
#   {{go}} get-cert
#
# All arguments are optional, as the user will be prompted to enter the
# necessary information as needed. See `{{go}} help site-setup` for more
# information.
#
# If successful, you can then run {{go}} webserver-config to generate a
# configuration file for your web server that makes use of the new certificate
# and associated artifacts.

_cws.setup_all() {
  local site_name="$1"
  local key_file="$2"
  local email_address="$3"

  if ! @go certbot-setup; then
    return 1
  elif ! @go site-setup "$site_name" "$key_file" "$email_address"; then
    return 1
  fi
  @go get-cert "$site_name" "$site_name"
}

_cws.setup_all "$@"
